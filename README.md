# Spam Image Detector

This project focuses on classifying customer review images into spam and non-spam categories. It leverages state-of-the-art deep learning models and includes all the necessary files for seamless deployment. Two endpoints are defined to facilitate interaction with the models:  
1. `vit_predict/`: Submit an image to this endpoint to obtain predictions generated by a fine-tuned Vision Transformer model. 
2. `predict/`: Submit an image to this endpoint to obtain predictions generated by a composite model integrating image, language and boosting models. 

## Table of Contents

1. [Setup](#setup)
2. [Building Docker Image](#building-docker-image)
3. [Making API calls](#making-api-calls)
4. [Running Tests](#running-tests)


## Setup
1. Clone the repository to your local machine.
```code
git clone https://github.com/ye2531/spam-images-detector
```
2. Start the service. 
```code
docker-compose up
```
By default pre-built image will be pulled from Docker Hub. If you want to build Docker image from provided Dockerfile, modify `docker-compose.yml` file accordingly. 
    
## Building Docker Image
To build the Docker image from provided Dockerfile, go to `docker-compose.yml`, comment out `image` directive and uncomment `build` one. Then run
```bash
docker-compose build
docker-compose up
```

## Making API calls 

If you are running Docker Compose in detached mode, make sure application startup has been completed before making any calls. You can check logs to track the application startup process by running 
```bash
docker logs <container_id>
```
This can be especially useful when starting the service for the first time, since pre-trained models are downloaded and converted to ONNX format at the first launch.

Below is python code snippet that demonstrates how to make API calls to one of endpoints:
```python
import requests


urls = {"vit_16": "http://localhost:8080/vit_predict"}

with open("spam_image.jpg", "rb") as f: 
    response = requests.post(urls["vit_16"], files={"input_file": f.read()})
```
Alternatively, you can use simple curl command as follows

```code
curl -X POST -F input_file=@"tests/test_data/spam_image.jpg" http://0.0.0.0:8000/vit_predict
```

## Running Tests
To run tests, start the service in detached mode using 
```bash
docker-compose up -d
```
then execute following command
```bash
docker exec <container_id> py.test -s tests/test.py
```

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.